---
// Import Astro fetch utility
import { fetchContent } from "astro/content";

async function fetchInstagramFeed(accessToken) {
  const url = `https://graph.instagram.com/me/media?fields=id,caption,media_type,media_url,thumbnail_url,permalink,timestamp&access_token=${accessToken}&limit=4`;
  const response = await fetch(url);
  const data = await response.json();
  return data.data;
}

// Fetch the Instagram feed using your access token
const accessToken = import.meta.env.INSTAGRAM_ACCESS_TOKEN;
const instagramFeed = await fetchInstagramFeed(accessToken);
---

<div class="instagram-grid">
  {
    instagramFeed.map((post) => (
      <a href={post.permalink} target="_blank" rel="noopener noreferrer">
        <article key={post.id} class="instagram-post">
          {post.media_type === "IMAGE" ? (
            <img
              src={post.media_url}
              alt={post.caption}
              class="instagram-image"
            />
          ) : (
            <video src={post.media_url} controls class="instagram-image" />
          )}
        </article>
      </a>
    ))
  }
</div>

<style lang="scss">
  .instagram-grid {
    display: grid;
    justify-content: center;
    grid-template-columns: repeat(2, 8rem);
    grid-template-rows: repeat(2, 6rem);
    grid-gap: var(--space-2xs);
    align-items: stretch;

    @media screen and (max-width: 1024px) {
      grid-template-columns: repeat(4, minmax(6rem, 1fr));
      grid-template-rows: repeat(1, minmax(8rem, 1fr));
      grid-gap: var(--space-sm);
    }
    @media screen and (max-width: 768px) {
      justify-content: center;
      grid-template-rows: repeat(1, minmax(6rem, 1fr));
      grid-gap: var(--space-2xs);
    }
    @media screen and (max-width: 576px) {
      grid-template-columns: repeat(2, minmax(6rem, 1fr));
      grid-template-rows: repeat(2, 10rem);
    }
    a,
    article {
      width: 100%;
      height: 100%;

      &::after,
      &::before {
        content: none !important;
      }
    }

    img,
    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 0.5rem;
    }
  }
</style>
