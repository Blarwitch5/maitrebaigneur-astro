<button id="gototopBtn" class="gototop-btn" title="Retour en haut de la page" aria-label="Retour en haut de la page">
	<span class="visually-hidden">Retour en haut de la page</span>
	<span></span>
</button>

<style lang="scss">
	.gototop-btn {
		display: none;
		position: fixed;
		width: 3rem;
		height: 3rem;
		bottom: 20px;
		right: 30px;
		z-index: 99;
		border: none;
		cursor: pointer;
		padding: 15px;
		border-radius: 100vw;
		font-size: 18px;

		&.light {
			background-color: var(--color-bg-light);
			color: black;
			box-shadow: 0 10px 15px -3px hsla(var(--link-color-bg-light-hsl), 0.3), 0 4px 6px -4px hsla(var(--link-color-bg-light-hsl), 0.3);

			&:hover {
				  background-color: #555; /* Add a dark-grey background on hover */
			}
		}
		&.dark {
			background-color: var(--color-primary);
			color: white;
			box-shadow: 0 10px 15px -3px hsla(var(--link-color-primary-hsl), 0.3), 0 4px 6px -4px hsla(var(--link-color-primary-hsl), 0.3);

			&:hover {
				  background-color: #555; /* Add a dark-grey background on hover */
			}
		}
	}
</style>
<script>
	// Get the "back to top" button
	const gototopBtn = document.getElementById("gototopBtn");
	// When the user clicks on the button, scroll to the top of the document
	gototopBtn.addEventListener("click", topFunction);
	// Get the main element
	let main = document.querySelector("main");
	// Get all the sections inside the main element
	let sections = main.querySelectorAll("section");
	// Get the footer element
	let footer = document.querySelector("footer");

	window.addEventListener("scroll", function () {
		scrollFunction();
	});
	window.addEventListener("scroll", function () {
		// Get all sections
		let allSections = [...sections, footer];
		// Loop through all sections
		for (let i = 0; i < allSections.length; i++) {
			// Get the section
			let section = allSections[i];
			// Get the section's rectangle
			let sectionRect = section.getBoundingClientRect();
			// Get the button's rectangle
			let buttonRect = gototopBtn.getBoundingClientRect();
			// If the button's top is inside the section's rectangle, get the background color
			if (buttonRect.bottom >= sectionRect.top && buttonRect.bottom <= sectionRect.bottom) {
				// Get the background color
				let bgColor = window.getComputedStyle(section).getPropertyValue("background-color");
				// Get the color's RGB values
				let color;
				if (bgColor.includes("rgba(")) {
					color = /rgba\((\d+),\s*(\d+),\s*(\d+),\s*([\d.]+)\)/g.exec(bgColor);
				} else {
					color = /rgb\((\d+),\s*(\d+),\s*(\d+)\)/g.exec(bgColor);
				}
				// Get the RGB values
				let r = color[1],
					g = color[2],
					b = color[3];
				// Check the brightness
				const brightness = isLight(r, g, b);
				// If the brightness is light, add the light class to the button
				if (brightness) {
					gototopBtn.classList.remove("light");
					gototopBtn.classList.add("dark");
					// If the brightness is dark, add the dark class to the button
				} else {
					gototopBtn.classList.remove("dark");
					gototopBtn.classList.add("light");
				}
			}
		}
	});
	// A function that returns a boolean value based on whether
	// the combination of RGB values is considered light or not.
	// The function takes three parameters: r, g, and b.
	function isLight(r: number, g: number, b: number): boolean {
		// Calculate brightness based on the RGB values
		// RGB values range from 0 to 255
		let brightness = (r * 299 + g * 587 + b * 114) / 1000;
		// Return true if the brightness is above 128
		return brightness > 128 || brightness === 0;
	}
	// When the user scrolls down 20px from the top of the document, show the button
	function scrollFunction() {
		// Get the current scroll position of the page
		var scroll = document.body.scrollTop || document.documentElement.scrollTop;
		// If the current scroll position is greater than 20px, show the button
		if (scroll > 20) {
			gototopBtn.style.display = "block";
		} else {
			gototopBtn.style.display = "none";
		}
	}
	function topFunction() {
		// This function scrolls the body to the top of the page
		document.body.scrollTop = 0; // For Safari
		document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
	}
</script>
